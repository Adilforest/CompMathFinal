import numpy as np
import matplotlib.pyplot as plt

# ===============================
# Шаг 1. Ввод данных от пользователя
# ===============================
# Запрашиваем число подынтервалов (должно быть чётным, например, 10)
n = int(input("Введите число подынтервалов (четное число, например 10): "))
if n % 2 != 0:
    raise ValueError("Число подынтервалов должно быть четным для правила Симпсона.")

# Границы интегрирования
a = 0.0
b = np.pi

# ===============================
# Шаг 2. Вычисление параметров метода Симпсона
# ===============================
h = (b - a) / n  # Шаг разбиения

# Генерируем узловые точки
x_vals = np.linspace(a, b, n+1)
f_vals = np.sin(x_vals)

# Вывод таблицы значений узловых точек и значений функции
print("\nТаблица значений f(x)=sin(x):")
print("{:<10} {:<15}".format("x", "sin(x)"))
for x_val, f_val in zip(x_vals, f_vals):
    print("{:<10.4f} {:<15.8f}".format(x_val, f_val))

# ===============================
# Шаг 3. Вычисление интеграла по правилу Симпсона 1/3
# ===============================
# Формула: I ≈ (h/3)[ f(x0) + f(x_n) + 4*Σ_{i odd} f(x_i) + 2*Σ_{i even, i=2..n-2} f(x_i) ]
I_simpson = f_vals[0] + f_vals[-1]
I_simpson += 4 * np.sum(f_vals[1:-1:2])
I_simpson += 2 * np.sum(f_vals[2:-1:2])
I_simpson *= h / 3

print("\nВычисленное значение интеграла по правилу Симпсона 1/3:", I_simpson)

# Точное значение интеграла ∫ sin(x) dx от 0 до π = 2
I_exact = 2.0
print("Точное значение интеграла:", I_exact)

# Вычисляем абсолютную ошибку
abs_error = abs(I_exact - I_simpson)
print("Абсолютная ошибка:", abs_error)

# ===============================
# Шаг 4. Построение графика
# ===============================
# Строим график функции sin(x) на интервале [0, pi] и отмечаем узловые точки, используемые в методе Симпсона
x_plot = np.linspace(a, b, 400)
y_plot = np.sin(x_plot)

plt.figure(figsize=(8, 6))
plt.plot(x_plot, y_plot, label='f(x)=sin(x)', color='blue')
plt.scatter(x_vals, f_vals, color='red', zorder=5, label='Узловые точки')
plt.xlabel('x')
plt.ylabel('sin(x)')
plt.title("Интегрирование sin(x) от 0 до π по правилу Симпсона 1/3")
plt.legend()
plt.grid(True)
plt.show()
